# Домашнее задание IaC 1

Создать с помощью Terraform конфигурацию AWS, которая:

* создает две подсети private и public в дефолтной VPC
* создает в каждой подсети ВМ:
* к ВМ в public разрешает подключение по ssh, http(s)
* к ВМ в private разрешает подключение по ssh, 8080
* устанавливает на ВМ Nginx с помощью любого провижинера terraform

# Запуск и работа с проектом 

1. Чтобы подключиться к AWS с помощью terraform первым делом необходимо описать конфигурацию провайдера.
Данная конфигурация описана в файле **providers.tf**.
Также в нём можно описать регион и креды (Access Key и SecretKey).
Но, чтобы не светить Access Key и SecretKey, мы будем использовать их через переменные окружения:
```$ export AWS_PROFILE=<имя профиля aws>```

2. По понятным причинам необходимо настроить зеркало для terraform.
Необходимо создать в корневой папке пользователя файл **.terraformrc** со следующим содержимым:

```
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
}
```

3. Запускаем команду ```$ terraform init```, чтобы проинициализировался terraform и установился провайдер.

4. Для управления описанной конфигурации используем следующие команды:

```
$ terraform plan         - проверка изменений при запуске описанной конфигурации
$ terraform apply        - запуск конфигурации
$ terraform show         - вывод запущенную конфигурацию
$ terraform output       - выведет аутпуты
$ terraform destroy      - уничтожить запущенную конфигурацию
```
 
# Описание файлов

* [providers.tf](providers.tf) содержит конфигурацию провайдера

* [variables.tf](variables.tf) содержит конфигурацию переменных

* [vpc.tf](vpc.tf) содержит конфигурацию vpc

* [main.tf](main.tf) содержит конфигурацию инстансов

* [sg.tf](sg.tf) содержит конфигурацию групп безопасности

* [outputs.tf](outputs.tf) содержит конфигурацию аутпутов

* [init.sh](init.sh) скрипт, который передается и запускается через параметр user_data при инициализации виртуальной машины

* [terraform.tfstate](terraform.tfstate) содержит последнюю запущенную конфигурацию. 
***Важно: данный файл нельзя удалять; при утрате данного файла, созданная через terraform конфигурация станет неуправляемой.***

* [terraform.tfstate.backup](terraform.tfstate.backup) содержит предпоследнюю запущенную конфигурацию